From 9af38c3b90ab9a4344efd74e42011d5cde5a1c73 Mon Sep 17 00:00:00 2001
From: Kamil Dziezyk <kamil.dziezyk@arm.com>
Date: Tue, 22 Mar 2022 10:58:19 +0000
Subject: [PATCH] security: move x86_64 configs to separate file
Upstream-Status: Pending

Signed-off-by: Kamil Dziezyk <kamil.dziezyk@arm.com>
---
 features/security/security-x86_64.cfg | 4 ++++
 features/security/security.cfg        | 4 ----
 features/security/security.scc        | 4 ++++
 3 files changed, 8 insertions(+), 4 deletions(-)
 create mode 100644 features/security/security-x86_64.cfg

diff --git a/features/security/security-x86_64.cfg b/features/security/security-x86_64.cfg
new file mode 100644
index 00000000..dad137f6
--- /dev/null
+++ b/features/security/security-x86_64.cfg
@@ -0,0 +1,4 @@
+# SPDX-License-Identifier: MIT
+# Modern libc no longer needs a fixed-position mapping in userspace, remove it as a possible target.
+# CONFIG_LEGACY_VSYSCALL_EMULATE is not set
+CONFIG_LEGACY_VSYSCALL_NONE=y
diff --git a/features/security/security.cfg b/features/security/security.cfg
index 475b647e..5befeb90 100644
--- a/features/security/security.cfg
+++ b/features/security/security.cfg
@@ -26,10 +26,6 @@ CONFIG_STACKPROTECTOR_STRONG=y
 CONFIG_EXPERT=y
 CONFIG_MODIFY_LDT_SYSCALL=n
 
-# Modern libc no longer needs a fixed-position mapping in userspace, remove it as a possible target.
-# CONFIG_LEGACY_VSYSCALL_EMULATE is not set
-CONFIG_LEGACY_VSYSCALL_NONE=y
-
 # Prior to v4.1, assists heap memory attacks; best to keep interface disabled.
 # CONFIG_INET_DIAG is not set
 
diff --git a/features/security/security.scc b/features/security/security.scc
index 4abdf457..c6ca31f0 100644
--- a/features/security/security.scc
+++ b/features/security/security.scc
@@ -3,3 +3,7 @@ define KFEATURE_DESCRIPTION "Enable/disable configurations that impact kernel se
 define KFEATURE_COMPATIBILITY all
 
 kconf non-hardware security.cfg
+
+if [ "$KARCH" = "x86_64" ]; then
+    kconf non-hardware security-x86_64.cfg
+fi
-- 
2.17.1

