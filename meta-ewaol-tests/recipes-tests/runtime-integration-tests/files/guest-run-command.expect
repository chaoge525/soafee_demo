#!/usr/bin/env expect
#
# Copyright (c) 2021-2022, Arm Limited.
#
# SPDX-License-Identifier: MIT

set guest_name [lindex "${argv}" 0]
set cmd [lindex "${argv}" 1]
set login_prompt "${guest_name} login:"
set prompt "root@${guest_name}:"
set clean_console "\025\010\r"
set timeout 60

source "virtual-guest-funcs.expect"

set rc [guest_logon "${guest_name}"]
if { $rc != 0 } {
    puts "Failed to log-in to '${guest_name}'"
    exit 1
}

set rc [run_cmd "${cmd}"]
if { $rc != 0 } {
    puts "Failed to run '${cmd}' on '${guest_name}'"
    exit 1
}

set rc [guest_logoff]
if { $rc != 0 } {
    puts "Failed to log-off from '${guest_name}'"
    exit 1
}

puts "Success"
exit 0
